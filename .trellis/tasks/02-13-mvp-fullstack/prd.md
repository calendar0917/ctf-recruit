# Task: mvp-fullstack

## Overview
完成 CTF Recruit 平台 MVP 的端到端可运行演示，覆盖账户认证、题目管理与提交判题（静态 + 动态闭环）、积分与排行榜、以及基础运维交付能力。实现应保证 API、判题 Worker、数据库与前端页面在同一演示链路中协同工作。

## Requirements
- 实现并验证账户与认证流程：注册、登录、获取当前用户信息、基于角色的受限接口访问。
- 完成题目模块 MVP：题目创建/更新/发布（管理员）、题目列表/详情（选手），支持静态与动态模式。
- 完成提交流程 MVP：
  - 静态题：提交后即时判题并返回结果。
  - 动态题：提交后入队，Worker 异步处理，最终回写提交结果与判题任务状态。
- 完成积分与排行榜：提交成功后按规则计分，防止重复积分，支持排行榜查询与排序。
- 完成运维与交付基础：
  - 提供 API、Worker、数据库与前端的可运行组合编排。
  - 具备最小化环境变量说明与启动方式。
- 以前后端联通的端到端演示作为验收：用户可从登录→做题→提交→查看排行榜完成完整闭环。

## Acceptance Criteria
- [ ] 鉴权接口可用：`/api/v1/auth/register`、`/api/v1/auth/login`、`/api/v1/auth/me`；无 token 请求受保护资源返回 401。
- [ ] RBAC 生效：管理员接口被普通用户访问时返回 403。
- [ ] 题目管理可用：管理员可创建并管理题目，题目包含静态/动态模式配置。
- [ ] 静态判题可闭环：正确 flag 提交后返回 accepted 并产生积分。
- [ ] 动态判题可闭环：提交进入 pending，Worker 处理后状态更新为最终结果，并可在查询中观察到。
- [ ] 积分防重复：同一用户对同一题目的重复成功提交不会重复加分（受唯一索引/业务逻辑保护）。
- [ ] 排行榜正确：按分数与既定次级规则排序，结果可查询。
- [ ] `docker-compose` 能启动核心服务并支持端到端演示流程。
- [ ] 质量门禁通过：仓库级 `lint`、`type-check`、`test` 命令均通过。

## Technical Notes
- 动态判题链路已有基础：`submission/service` 在动态模式下创建 pending 提交并 enqueue；`judge/queue` 负责异步执行并收敛结果。
- 判题结果收敛依赖事务写回：`judge/repository` 中 `FinalizeExecution` 需保持 submission 与 judge_job 状态一致性。
- 重复积分防护由数据库约束支持：`submissions` 上存在按 `(user_id, challenge_id)` 的条件唯一索引（`awarded_points > 0`）。
- 排行榜由 `scoreboard/repository` 聚合 submissions 生成，`scoreboard/service` 实施排序规则；实现与测试需确保规则一致。
- 当前前端仅健康检查页，MVP 需补齐核心页面流程（登录、题目列表/详情、提交入口、排行榜、必要管理入口）。
- 现有 `.trellis/spec` 文档多为模板占位，实施时应优先遵循仓库现有模块模式与测试样例。

## Out of Scope
- 不包含复杂反作弊体系与高级风控策略。
- 不包含多租户、组织级权限体系。
- 不包含完整生产级监控告警平台（仅保留 MVP 级可运行与基础诊断能力）。
- 不包含高并发压测优化与容量规划专项。